<main class="m-2">
    <section class="flex flex-column mt-3 md:flex-row">
        <h1 class="inline text-4xl text-center my-0 md:text-5xl md:text-left">
            Lista de Aplicaciones
        </h1>
        <a
            *ngIf="user!.position.nom_puesto !== Nom_Puestos.INVITADO"
            pRipple 
            routerLink="/apps/new-app"
            pTooltip="Subir una aplicación" 
            tooltipPosition="left"  
            class="p-button font-bold mx-auto mt-4 md:mt-0 md:ml-auto md:mr-0 bnt-new">
            <span class="pi pi-plus-circle mr-2" style="font-size: 1.4rem"></span>
            Nueva
        </a>
    </section>
    
    <div *ngIf="isLoading" class="card flex justify-content-center my-6">
        <p-progressSpinner ariaLabel="loading" />
    </div>
    
    <div *ngIf="!isLoading && aplications.length === 0" class="my-6">
        <h2 class="text-center">
            ¡No hay aplicaciones para listar!
        </h2>
    </div>
    
    <section *ngIf="!isLoading && aplications.length > 0" class="mt-4">
        <div class="card">
            <p-table [value]="aplications" [tableStyle]="{ 'min-width': '50rem'}" [lazy]="true" >
                <ng-template pTemplate="header">
                    <tr>
                        <th *ngFor="let col of colums">
                            {{ col }}
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-app let-index="rowIndex">
                    <tr [ngClass]="{'change': isChangeStatus }" >
                        <td>{{ app.idu_aplicacion }}</td>
                        <td>{{ app.nom_aplicacion }}</td>
                        <td *ngIf="user!.position.nom_puesto !== Nom_Puestos.INVITADO && 
                                   user!.position.nom_puesto !== Nom_Puestos.USUARIO">
                            {{ app.user.nom_usuario }}
                        </td>
                        <td *ngIf="user!.position.nom_puesto === Nom_Puestos.AUTORIZADOR || 
                                   user!.position.nom_puesto === Nom_Puestos.ADMINISTRADOR; 
                            else authStatus">
                            <p-dropdown
                                [id]="app.idu_aplicacion + 'selectInputFin'"
                                *ngIf="app.applicationstatus.idu_estatus_aplicacion === StatusApps.DONE; else selectStatus"
                                [options]="[{name: 'Finalizado', code: 3}]"
                                [ngModel]="app.applicationstatus.idu_estatus_aplicacion"
                                optionLabel="name"
                                optionValue="code"
                                [disabled]="true"
                            />
                            <ng-template #selectStatus>
                                <p-dropdown
                                    [id]="app.idu_aplicacion + 'selectInput'"
                                    [options]="statusOpcs"
                                    [ngModel]="app.applicationstatus.idu_estatus_aplicacion"
                                    optionLabel="name"  
                                    optionValue="code"
                                    placeholder="Select a status"
                                    (onChange)="onChangeStatus($event, app,index)"
                                />  
                            </ng-template>
                         </td>
                         <ng-template #authStatus>
                             <td>{{ app.applicationstatus.idu_estatus_aplicacion | statusApp}}</td>
                         </ng-template>
                        <td *ngIf="user!.position.nom_puesto !== Nom_Puestos.INVITADO">
                            <a 
                                *ngIf="app.applicationstatus.idu_estatus_aplicacion === StatusApps.DONE; else empty"
                                pTooltip="Descargar ZIP" 
                                tooltipPosition="top" 
                                class="c-pointer icon-down"
                                (click)="onDownloadFile(app)">
                                <i class="pi pi-arrow-circle-down" style="font-size: 1.6rem"></i>
                            </a>
                            <ng-template #empty>
                                <p class="m-0" style="padding-block: 3.5px;"><b>N/A</b></p>
                            </ng-template>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <p-paginator 
            (onPageChange)="onPageChange($event)" 
            [first]="0"
            [rows]="elementPerPage" 
            [totalRecords]="totalItems" 
        />
    </section>
    <p-toast [breakpoints]="{ '920px': { width: '90%', right: '5' } }"/>
    <p-confirmDialog [style]="{'padding': '10px'}"/>
</main>