<section class="flex mt-3">
    <h1 class="inline text-5xl my-0 ">Lista de Aplicaciones</h1>
    <a
        *ngIf="user!.position.nom_puesto !== 'Invitado'"
        pRipple 
        routerLink="/apps/new-app"
        pTooltip="Subir una aplicación" 
        tooltipPosition="left"  
        class="p-button font-bold ml-auto bnt-new">
        <span class="pi pi-plus-circle mr-2" style="font-size: 1.4rem"></span>
        Nueva
    </a>
</section>

<div *ngIf="isLoading" class="card flex justify-content-center">
    <p-progressSpinner ariaLabel="loading" />
</div>

<div *ngIf="!isLoading && aplications.length === 0">
    <h2>¡No hay aplicaciones para listar!</h2>
</div>


<section *ngIf="!isLoading && aplications.length > 0" class="mt-4">
    <div class="card">
        <p-table [value]="aplications" [tableStyle]="{ 'min-width': '50rem'}" [lazy]="true" >
            <ng-template pTemplate="header">
                <tr>
                    <th *ngFor="let col of colums">
                        {{ col }}
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-app let-index="rowIndex">
                <tr [ngClass]="{'change': isChangeStatus }" >
                    <td>{{ app.idu_aplicacion }}</td>
                    <td>{{ app.nom_aplicacion }}</td>
                    <td *ngIf="user!.position.nom_puesto !== 'Invitado' && user!.position.nom_puesto !== 'Usuario'">{{ app.user.nom_usuario }}</td>
                    <td *ngIf="user!.position.nom_puesto === 'Autorizador' || user!.position.nom_puesto === 'Administrador'; else authStatus">
                        <p-dropdown
                            [id]="app.idu_aplicacion + 'selectInputFin'"
                            *ngIf="app.applicationstatus.idu_estatus_aplicacion === 3; else selectStatus"
                            [options]="[{name: 'Finalizado', code: 3}]"
                            [ngModel]="app.applicationstatus.idu_estatus_aplicacion"
                            optionLabel="name"
                            optionValue="code"
                            [disabled]="true"
                        />
                        <ng-template #selectStatus>
                            <p-dropdown
                                [id]="app.idu_aplicacion + 'selectInput'"
                                [options]="statusOpcs"
                                [ngModel]="app.applicationstatus.idu_estatus_aplicacion"
                                optionLabel="name"  
                                optionValue="code"
                                placeholder="Select a status"
                                (onChange)="onChangeStatus($event, app,index)"
                            />  
                        </ng-template>
                        
                     </td>
                     <ng-template #authStatus>
                         <td>{{ app.applicationstatus.idu_estatus_aplicacion | statusApp}}</td>
                     </ng-template>
                    <td *ngIf="user!.position.nom_puesto !== 'Invitado'">
                        <a 
                            *ngIf="app.applicationstatus.idu_estatus_aplicacion === 3"
                            pTooltip="Descargar ZIP" 
                            tooltipPosition="top" 
                            class="c-pointer icon-down"
                            (click)="onDownloadFile(app)">
                            <i class="pi pi-arrow-circle-down" style="font-size: 1.6rem"></i>
                        </a>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
    <p-paginator 
        (onPageChange)="onPageChange($event)" 
        [first]="0"
        [rows]="5" 
        [totalRecords]="totalItems" 
    />
</section>
<p-toast />
<p-confirmDialog/>